{% extends "_layouts/default.html" %}

{# Acquire URL segments #}
{% set baseUrlSegments = 1 %}
{% set segment1 = craft.request.segment(baseUrlSegments + 1) %}
{% set segment2 = craft.request.segment(baseUrlSegments + 2) %}
{% set segment3 = craft.request.segment(baseUrlSegments + 3) %}
{% set segment4 = craft.request.segment(baseUrlSegments + 4) %}
{% set segment5 = craft.request.segment(baseUrlSegments + 5) %}

{% set targetDate = "today" %}
{% set calendarHandle = null %}
{% if segment2 == "calendar" %}
    {% set calendarHandle = segment3 %}
    {% if segment4 %}
        {% set targetDate = segment4~"-"~segment5~"-01" %}
    {% endif %}
{% elseif segment2 is not empty %}
    {% set targetDate = segment2~"-"~segment3~"-01" %}
{% endif %}

{% set month = craft.calendar.month({
    date: targetDate,
    calendar: calendarHandle
}) %}

{% set calendars = craft.calendar.calendars({
  order: "name",
  sort: "asc"
}) %}

{% if calendarHandle != null %}
  {% set mainTitle = "Programme #{calendarHandle|capitalize}" %}
  {% set pageTitle = mainTitle %}
{% else %}
  {% set mainTitle = "Programmation" %}
  {% set pageTitle = mainTitle %}
{% endif %}
{% set page = "month" %}

{% block content %}
    
    
    <div id="events" class="row" calendar-type="month">
        {% if month.events|length %}
        <div class="month">
          <div class="c12 fl">
            <a href="{{ siteUrl }}programmation/month/{{month.date.format('Y')}}/{{month.date.format('m')}}">
              <div class="c3 fl">
                <h2>{{month.date.format('Y')|capitalize}}</h2>
              </div>
              <div class="c9 fl">
                <h2>{{month.date.format('F')|capitalize}}</h2>
              </div>
            </a>
          </div>
          <div id="events-items" class="c12 fl pt2">
            {% for event in month.events %}
                {% include "programmation/layouts/_event.html" %}
            {% else %}
                <!-- <h3 class="lead">Programmation bient√¥t disponible</h3> -->
            {% endfor %}
          </div>
        </div>
        {% endif %}
    </div>

    <div id="event-pagination" class="row">
      <a class="previous-month title" href="{{ siteUrl }}programmation/month/{{ segment2 == "calendar" ? "calendar/"~segment3~"/" }}{{ month.previousDate.format('Y/m') }}">
          <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
   viewBox="-46 -38.9 100 88.7" enable-background="new -46 -38.9 100 88.7" xml:space="preserve">
          <polygon points="-46,5.4 -1.9,49.9 7.1,41.2 -22.4,11.7 54,11.7 54,-0.6 -22.6,-0.6 7.1,-30.2 -1.9,-38.9 -46,5.3 -45.9,5.4 "/>
          </svg>
          <span>{{ month.previousDate.format('F')|capitalize }}</span>
      </a>

      <a class="next-month title" href="{{ siteUrl }}programmation/month/{{ segment2 == "calendar" ? "calendar/"~segment3~"/" }}{{ month.nextDate.format('Y/m') }}">
          <span>{{ month.nextDate.format('F')|capitalize }}</span>
          <svg version="1.1" id="Calque_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px"
   viewBox="-46 -38.9 100 88.7" enable-background="new -46 -38.9 100 88.7" xml:space="preserve">
          <polygon points="54,5.6 9.9,-38.9 0.9,-30.2 30.4,-0.7 -46,-0.7 -46,11.6 30.6,11.6 0.9,41.2 9.9,49.9 54,5.7 53.9,5.6 "/>
          </svg>
      </a>
    </div>

{% endblock %}
